---
// src/pages/siswa/index.astro
import StudentLayout from '../../layouts/StudentLayout.astro';
---

<StudentLayout title="Dashboard Siswa">
    
    <div class="bg-gradient-to-br from-emerald-600 to-teal-700 rounded-b-[2.5rem] text-white pb-14 pt-8 px-6 relative z-10 shadow-xl overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl pointer-events-none"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-emerald-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-xl pointer-events-none"></div>

        <div class="flex justify-between items-start mb-6 relative z-10">
            <div class="animate-fade-in-down flex-1 pr-4">
                <h2 class="text-lg font-bold leading-tight drop-shadow-sm line-clamp-2" id="headerName">
                    <span class="loading loading-dots loading-xs opacity-50"></span>
                </h2>
                <div class="inline-flex items-center gap-1.5 mt-1.5 bg-white/10 px-3 py-1 rounded-full border border-white/10 backdrop-blur-sm">
                    <i class="fa-solid fa-school text-[10px] text-emerald-200"></i>
                    <span id="headerClass" class="text-xs font-medium text-emerald-50">Memuat...</span>
                </div>
            </div>

            <div class="flex gap-3 shrink-0 animate-fade-in-down delay-100">
                <a href="/siswa/notifikasi" class="btn btn-circle btn-sm btn-ghost text-white hover:bg-white/20 border border-white/20 shadow-sm transition-all active:scale-95 relative">
                    <i class="fa-regular fa-bell text-sm"></i>
                    <span class="absolute top-0 right-0 block h-2.5 w-2.5 rounded-full bg-red-500 ring-2 ring-emerald-600 transform scale-75"></span>
                </a>

                <a href="/siswa/profile" class="btn btn-circle btn-sm btn-ghost text-white hover:bg-white/20 border border-white/20 shadow-sm transition-all active:scale-95">
                    <i class="fa-solid fa-user text-sm"></i>
                </a>
            </div>
        </div>

        <div class="mt-2 mb-2 relative z-10 animate-fade-in-up">
            <h1 class="text-3xl font-extrabold tracking-tight" id="welcomeText">Halo! ðŸ‘‹</h1>
            <p class="text-emerald-100 text-sm mt-1 opacity-90 font-medium">Siap menyelesaikan tantangan hari ini?</p>
        </div>
    </div>

    <div class="px-5 -mt-10 relative z-20 pb-24 max-w-md mx-auto w-full">
        
        <div id="filterSection" class="sticky top-4 z-30 mb-6 hidden animate-fade-in-up delay-200">
            <div class="card bg-white/95 backdrop-blur-md shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-gray-100 p-3 rounded-2xl">
                <div class="flex flex-col gap-3">
                    <label class="input input-sm flex items-center gap-3 bg-gray-50 border-transparent focus-within:bg-white focus-within:border-emerald-500 focus-within:ring-2 focus-within:ring-emerald-100 rounded-xl transition-all w-full h-10">
                        <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                        <input type="text" id="searchInput" class="grow text-sm font-medium placeholder:text-gray-400" placeholder="Cari tugas..." />
                    </label>
                    
                    <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar filter-container scroll-smooth">
                        <button class="btn btn-xs h-8 rounded-full px-5 font-bold shadow-sm transition-all hover:shadow-md filter-btn btn-primary text-white border-none" data-filter="all">Semua</button>
                        <button class="btn btn-xs h-8 rounded-full px-5 font-medium bg-white border border-gray-200 text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-all filter-btn" data-filter="pending">Belum</button>
                        <button class="btn btn-xs h-8 rounded-full px-5 font-medium bg-white border border-gray-200 text-gray-500 hover:bg-gray-50 hover:border-gray-300 transition-all filter-btn" data-filter="done">Selesai</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-end mb-4 px-1 animate-fade-in delay-300">
            <h3 class="font-bold text-gray-800 text-lg tracking-tight">Daftar Tugas</h3>
            <span class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg border border-emerald-100" id="taskCount">Memuat...</span>
        </div>

        <div id="loadingState" class="grid grid-cols-2 gap-3 animate-pulse">
            <div class="h-40 bg-gray-200 rounded-2xl"></div>
            <div class="h-40 bg-gray-200 rounded-2xl"></div>
            <div class="h-40 bg-gray-200 rounded-2xl"></div>
            <div class="h-40 bg-gray-200 rounded-2xl"></div>
        </div>

        <div id="taskGrid" class="grid grid-cols-2 gap-3 hidden pb-10"></div>

        <div id="emptyState" class="hidden flex-col items-center justify-center py-16 text-center animate-fade-in">
            <div class="w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mb-4 border border-gray-100 shadow-inner">
                <i class="fa-solid fa-clipboard-check text-3xl text-gray-300"></i>
            </div>
            <h4 class="text-gray-900 font-bold mb-1">Tidak ada tugas</h4>
            <p class="text-xs text-gray-500 max-w-[200px] leading-relaxed">Hebat! Kamu sudah menyelesaikan semua tanggung jawabmu.</p>
        </div>

        <div id="noClassState" class="hidden flex-col items-center justify-center py-12 text-center px-4 animate-fade-in">
            <div class="w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mb-4 border-4 border-white shadow-lg animate-bounce-slow">
                <i class="fa-solid fa-triangle-exclamation text-3xl text-orange-400"></i>
            </div>
            <h3 class="font-bold text-gray-800 text-lg">Belum Masuk Kelas</h3>
            <p class="text-sm text-gray-500 mt-2 mb-6 leading-relaxed max-w-xs mx-auto">
                Akunmu belum terdaftar di kelas manapun. Silakan hubungi Guru Walikelas.
            </p>
            <button onclick="location.reload()" class="btn btn-sm btn-primary text-white shadow-lg shadow-emerald-200 px-6 rounded-full">
                <i class="fa-solid fa-rotate-right mr-2"></i> Cek Lagi
            </button>
        </div>

        <div id="errorState" class="hidden flex-col items-center justify-center py-12 text-center px-6">
            <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-4 text-red-500">
                <i class="fa-solid fa-wifi text-2xl"></i>
            </div>
            <p class="text-sm font-bold text-gray-800">Gagal memuat data</p>
            <p class="text-xs text-gray-500 mt-1 mb-4" id="errorMsg">Periksa koneksi internet anda</p>
            <button onclick="window.location.reload()" class="btn btn-error btn-xs btn-outline rounded-full">Muat Ulang</button>
        </div>

    </div>

</StudentLayout>

<style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Animations */
    .animate-fade-in { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    .animate-fade-in-down { animation: fadeInDown 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    .animate-fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    @keyframes bounce-slow {
        0%, 100% { transform: translateY(-5%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
        50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
    }
    .animate-bounce-slow { animation: bounce-slow 2s infinite; }
</style>

<script src="../../scripts/pages/siswa/dashboard.js"></script>